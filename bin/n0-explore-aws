#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path( '../../lib', __FILE__ )

require 'n0'

if false
  puts "Metadata"
  db = N0.db(:admin)
  db.domains.each do |domain|
    p domain
    p domain.metadata.to_h
  end
end

# let's try to list items ...
db = N0.db() # not an admin
shapes = db.domains['Shape'].items.
  where('Timestamp is not null').
  order(:Timestamp,:desc).
  limit(N0::CONFIG['clustering_sample_size'])

shapes.each do |shape|
  puts shape.name
  lst = [ JSON.load(shape.attributes[:HuMoments].values[0]),
          JSON.load(shape.attributes[:Color].values[0]),
          JSON.load(shape.attributes[:VertexCount].values[0]),
          JSON.load(shape.attributes[:DefectsCount].values[0]) ].flatten
  puts lst.join("\t")
  puts
end
